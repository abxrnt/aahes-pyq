<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AAHES PYQ Portal</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.png">

  <!-- Quicksand font -->
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Lucide icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    body, html {
      margin: 0;
      font-family: 'Quicksand', sans-serif;
      background: #e3e6ff;
      height: 100%;
    }

    /* LOGIN SECTION */
    .login-bg {
      display: flex;
      height: 100vh;
      width: 100%;
      background: linear-gradient(135deg, #1f2a44, #117a65);
    }

    .login-left {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 5rem 3rem;
      color: #f0f0f0;
      backdrop-filter: blur(10px);
      background: rgba(0, 0, 0, 0.25);
      animation: fadeSlide 0.8s ease forwards;
      border-radius: 0 2rem 2rem 0;
    }

    .login-left h1 { font-size: 2rem; margin-bottom: 1.5rem; }
    .login-left input {
      width: 100%;
      padding: 0.9rem;
      margin-bottom: 1.2rem;
      border-radius: 1rem;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: #f0f0f0;
      font-size: 0.95rem;
      outline: none;
      transition: all 0.3s ease;
    }

    .login-left input:focus {
      background: rgba(255, 255, 255, 0.2);
      box-shadow: 0 0 12px rgba(255, 255, 255, 0.25);
    }

    .login-left button {
      width: 100%;
      padding: 0.9rem;
      border-radius: 1rem;
      border: none;
      background: #14b8a6;
      color: white;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .login-left button:hover {
      transform: translateY(-3px) scale(1.03);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
      background: #0d9488;
    }

    .login-left p { font-size: 0.9rem; opacity: 0.85; }
    .login-left a { color: #facc15; text-decoration: underline; }

    .login-right {
      flex: 1;
      background: url('https://images.unsplash.com/photo-1688494930045-328d0f95efe9?fm=jpg&q=60&w=3000') center/cover no-repeat;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      color: white;
      position: relative;
      padding: 3rem;
      border-radius: 2rem 0 0 2rem;
      overflow: hidden;
    }

    .login-right::before {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.35);
      border-radius: 2rem 0 0 2rem;
      z-index: 0;
    }

    .login-right>div {
      position: relative;
      z-index: 1;
      animation: fadeInUp 1s ease forwards;
    }

    #logoimg {
      width: 110px;
      margin-bottom: 1rem;
      filter: drop-shadow(0 0 12px rgba(255, 255, 255, 0.4));
    }

    .login-right h2 { font-size: 2.6rem; font-weight: 600; margin-bottom: 1rem; text-shadow: 0 3px 10px rgba(0,0,0,0.6); }
    .login-right p { font-size: 1.05rem; line-height: 1.6; opacity: 0.9; text-shadow: 0 2px 6px rgba(0,0,0,0.5); }

    @keyframes fadeSlide { 0% {opacity:0; transform:translateX(-40px);} 100% {opacity:1; transform:translateX(0);} }
    @keyframes fadeInUp { 0% {opacity:0; transform:translateY(30px);} 100% {opacity:1; transform:translateY(0);} }

    /* MAIN APP */
    #mainApp { display: none; padding: 1rem 2rem; max-width: 1200px; margin: auto; }

    #welcomeMsg { color: #0c2b4e; }

    /* NAVBAR */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 1rem;
      background: #0c2b4e;
      border-radius: 0.8rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .navbar img { height: 60px; width: auto; }
    .navbar .center { display: flex; gap: 0.4rem; flex-wrap: wrap; flex-grow:1; justify-content:center; margin:0.5rem 0; }
    .navbar .right { display:flex; gap:0.4rem; flex-wrap:wrap; justify-content:flex-end; }
    .navbar button {
      padding: 0.35rem 0.7rem;
      border-radius: 0.5rem;
      font-weight: 500;
      cursor: pointer;
      font-size: 0.85rem;
      color: white;
      border: none;
      transition: all 0.3s;
      box-shadow:0 3px 6px rgba(0,0,0,0.2);
      background: #1a3d64;
    }
    .navbar button:hover { transform:translateY(-2px) scale(1.03); box-shadow:0 6px 12px rgba(0,0,0,0.35); background:#1d546c; }
    .tab-active { background: linear-gradient(135deg,#2563eb,#1e40af)!important; color:#f8fafc!important; font-weight:600; box-shadow:0 4px 15px rgba(37,99,235,0.5); transform:translateY(-2px); transition: all 0.3s ease; }

    /* PROFILE & LOGOUT */
    .profile-btn { background:#facc15; color:#1f2a44; display:flex; align-items:center; gap:0.3rem; padding:0.5rem 1rem; border-radius:0.7rem; font-weight:500; box-shadow:0 4px 8px rgba(0,0,0,0.2); transition:all 0.3s; }
    .profile-btn:hover { background:#eab308; transform:translateY(-2px); box-shadow:0 8px 16px rgba(0,0,0,0.35); }
    .logout-btn { background:#f43f5e; color:white; display:flex; align-items:center; gap:0.3rem; padding:0.5rem 1rem; border-radius:0.7rem; font-weight:500; box-shadow:0 4px 8px rgba(0,0,0,0.2); transition:all 0.3s; }
    .logout-btn:hover { background:#e11d48; transform:translateY(-2px); box-shadow:0 8px 16px rgba(0,0,0,0.35); }

    /* TABLE */
    table { width:100%; border-collapse: collapse; font-size:0.875rem; }
    th, td { padding:0.6rem; border-bottom:1px solid #e2e8f0; text-align:left; }
    th { background:#0c2b4e; color:white; }
    td img { max-width:100%; border-radius:0.6rem; }
    tr:hover { background:#f0f8ff; }

    .view-btn { color:#0c2b4e; cursor:pointer; transition: all 0.2s; }
    .view-btn:hover { transform: scale(1.1); color:#0c2b4e; }

    /* MODALS */
    .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:50; }
    .modal-content { background:white; padding:2rem; border-radius:1.2rem; max-width:500px; width:90%; position:relative; box-shadow:0 15px 30px rgba(0,0,0,0.4); }
    .close-btn { position:absolute; top:1rem; right:1rem; font-size:1.3rem; font-weight:bold; cursor:pointer; transition:all 0.2s; }
    .close-btn:hover { color:#f39c12; transform:scale(1.2); }

    #imageModal .modal-content { max-width:350px; padding:1rem; border-radius:1rem; text-align:center; }
    .pyq-img {
  max-width: 200px;
  height: auto;
  cursor: pointer;
  border-radius: 0.5rem; /* optional, rounded corners */
  transition: transform 0.2s ease;
}

    /* UTILITY */
    .spacer { height: 12px; }
  </style>
</head>

<body>
  <!-- LOGIN -->
  <div class="login-bg" id="loginSection">
    <div class="login-left">
      <h1>Welcome Back</h1>
      <input type="email" placeholder="Email" id="emailInput" autocomplete="username" />
      <input type="password" placeholder="Password" id="passInput" autocomplete="current-password" />
      <button id="loginBtn">Login</button>
      <p>Forgot your password? <a href="https://aahes-assam.vercel.app/#pyqs">Click here</a></p>
      <div class="spacer"></div>
      <small style="opacity:0.85">Tip: use credentials from Firestore <code>users</code> collection.</small>
    </div>
    <div class="login-right">
      <div>
        <img id="logoimg" src="favicon.png" width="100px" alt="AAHES logo" />
        <h2>AAHES PYQ Portal</h2>
        <p>Access previous year questions as images easily.<br />Prepare smarter and faster for your exams.</p>
      </div>
    </div>
  </div>

  <!-- MAIN APP -->
  <section id="mainApp">
    <!-- NAVBAR -->
    <div class="navbar">
      <div class="left">
        <img src="favicon.png" alt="Logo" />
      </div>
      <div class="center" id="subjectButtons"></div>
      <div class="center" id="yearButtons"></div>
      <div class="right">
        <button id="profileBtn" class="profile-btn"><i data-lucide="user"></i> Profile</button>
        <button id="logoutBtn" class="logout-btn"><i data-lucide="log-out"></i> Logout</button>
      </div>
    </div>

    <h2 id="welcomeMsg" class="text-2xl font-semibold mb-4"></h2>

    <!-- PYQ TABLE -->
    <div class="w-full overflow-x-auto mt-2">
      <table class="w-full text-sm border-collapse">
        <thead>
          <tr>
            <th>QNo</th>
            <th>Question Image</th>
            <th>Solution</th>
          </tr>
        </thead>
        <tbody id="pyqTableBody">
          <tr><td colspan="3" class="text-center p-2">Select a subject and year</td></tr>
        </tbody>
      </table>
    </div>

    <!-- IMAGE MODAL -->
    <div id="imageModal" class="modal" onclick="closeImageModal()">
      <div class="modal-content" onclick="event.stopPropagation()">
        <span class="close-btn" onclick="closeImageModal()">&times;</span>
        <img id="pyqImage" src="" alt="PYQ Image" />
      </div>
    </div>
  </section>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBOVl1hdmprJXpgdN_sNTO3FsNePD_zNZY",
      authDomain: "aahes-cee-cutoffs.firebaseapp.com",
      databaseURL: "https://aahes-cee-cutoffs-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "aahes-cee-cutoffs",
      storageBucket: "aahes-cee-cutoffs.firebasestorage.app",
      messagingSenderId: "706066626405",
      appId: "1:706066626405:web:0d254ab82beb288108938c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const loginBtn = document.getElementById("loginBtn");
    const loginSection = document.getElementById("loginSection");
    const mainApp = document.getElementById("mainApp");
    const pyqTableBody = document.getElementById("pyqTableBody");
    const subjectButtons = document.getElementById("subjectButtons");
    const yearButtons = document.getElementById("yearButtons");

    let currentUser = null;
    let currentSubject = "physics";
    let currentYear = 2025;

    const subjects = ["physics", "chemistry", "maths"];
    const years = [2025, 2024, 2023, 2022];

    loginBtn.addEventListener("click", async () => {
      const email = document.getElementById("emailInput").value.trim();
      const password = document.getElementById("passInput").value.trim();
      if (!email || !password) { alert("Enter email & password"); return; }

      try {
        const q = query(collection(db, "users"), where("email","==",email));
        const snapshot = await getDocs(q);
        if(snapshot.empty) { alert("User not found"); return; }

        let found = false;
        snapshot.forEach(docSnap => {
          const data = docSnap.data();
          if(data.password === password) { found = true; currentUser = { id: docSnap.id, ...data }; }
        });
        if(!found){ alert("Incorrect password"); return; }
        onLoginSuccess();
      } catch(err){ console.error(err); alert("Login failed"); }
    });

    function onLoginSuccess() {
      loginSection.style.display = "none";
      mainApp.style.display = "block";
      document.getElementById("welcomeMsg").innerText = `Welcome, ${currentUser.name}!ðŸ˜Š`;
      generateButtons();
      loadPYQs();
      lucide.createIcons();
    }

    function generateButtons() {
      subjectButtons.innerHTML = "";
      subjects.forEach(s => {
        const btn = document.createElement("button");
        btn.innerText = s.charAt(0).toUpperCase()+s.slice(1);
        if(s===currentSubject) btn.classList.add("tab-active");
        btn.addEventListener("click", ()=>{currentSubject=s; subjectButtons.querySelectorAll("button").forEach(b=>b.classList.remove("tab-active")); btn.classList.add("tab-active"); loadPYQs();});
        subjectButtons.appendChild(btn);
      });

      yearButtons.innerHTML = "";
      years.forEach(y => {
        const btn = document.createElement("button");
        btn.innerText = y;
        if(y===currentYear) btn.classList.add("tab-active");
        btn.addEventListener("click", ()=>{currentYear=y; yearButtons.querySelectorAll("button").forEach(b=>b.classList.remove("tab-active")); btn.classList.add("tab-active"); loadPYQs();});
        yearButtons.appendChild(btn);
      });
    }

    async function loadPYQs() {
      try {
        pyqTableBody.innerHTML = "<tr><td colspan='3' class='text-center p-4'>Loading...</td></tr>";
        const q = query(collection(db, "pyqs"), where("subject","==",currentSubject), where("year","==",currentYear));
        const snapshot = await getDocs(q);
        pyqTableBody.innerHTML = "";

        if(snapshot.empty){
          pyqTableBody.innerHTML="<tr><td colspan='3' class='text-center p-4'>No questions found</td></tr>";
          return;
        }

        let items = [];
        snapshot.forEach(docSnap => items.push(docSnap.data()));
        items.sort((a,b) => (a.qno ?? Infinity)-(b.qno ?? Infinity));

        items.forEach(item => {
          const tr = document.createElement("tr");

          tr.innerHTML = `
            <td class="text-center">${item.qno ?? '-'}</td>
            <td class="text-center"><img src="${item.img ?? ''}" alt="Question ${item.qno}" onclick="openImageModal('${item.img ?? ''}')" class="cursor-pointer" /></td>
            <td class="text-center">${item.sol ? `<a href="${item.sol}" target="_blank" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 transition">Solution</a>` : '-'}</td>
          `;

          pyqTableBody.appendChild(tr);
        });

        lucide.createIcons();
      } catch(err){ console.error(err); pyqTableBody.innerHTML="<tr><td colspan='3'>Failed to load questions</td></tr>"; }
    }

    window.openImageModal = function(imgUrl){
      if(!imgUrl){ alert("No image available."); return; }
      document.getElementById("pyqImage").src = imgUrl;
      document.getElementById("imageModal").style.display="flex";
    };

    function closeImageModal(){ document.getElementById("imageModal").style.display="none"; }

    document.getElementById("logoutBtn").addEventListener("click", ()=>{
      currentUser = null;
      loginSection.style.display = "flex";
      mainApp.style.display = "none";
    });

  </script>
</body>
</html>

